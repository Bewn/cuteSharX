From dacdb25b350a73bbd3f7a4f530920e588a16aa3e Mon Sep 17 00:00:00 2001
From: Luke Shumaker <lukeshu@parabola.nu>
Date: Fri, 7 Jul 2017 21:29:52 -0400
Subject: [PATCH 15/38] nspawn: Expand comments in
 detect_unified_cgroup_hierarchy()

---
 src/nspawn/nspawn.c | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/src/nspawn/nspawn.c b/src/nspawn/nspawn.c
index 7fddee8808..d698cc8ad8 100644
--- a/src/nspawn/nspawn.c
+++ b/src/nspawn/nspawn.c
@@ -346,8 +346,8 @@ static int detect_inner_cgver_from_image(const char *directory) {
         int r;
         CGroupUnified outer_cgver;
 
-        /* Let's inherit the mode to use from the host system, but let's take into consideration what systemd in the
-         * image actually supports. */
+        /* By default, inherit from the host system, unless the container doesn't have a new enough systemd (detected
+         * by checking libsystemd-shared). */
         r = cg_version(&outer_cgver);
         if (r < 0)
                 return log_error_errno(r, "Failed to determine whether we are in all unified mode.");
@@ -356,8 +356,8 @@ static int detect_inner_cgver_from_image(const char *directory) {
         case CGROUP_UNIFIED_UNKNOWN:
                 assert_not_reached("unknown cgroup version");
         case CGROUP_UNIFIED_ALL:
-                /* Unified cgroup hierarchy support was added in 230. Unfortunately the detection
-                 * routine only detects 231, so we'll have a false negative here for 230. */
+                /* Unified cgroup hierarchy support was added in 230.  Unfortunately, libsystemd-shared (which we use
+                 * to sniff the systemd version) was only added in 231, so we'll have a false negative here for 230. */
                 r = systemd_installation_has_version(directory, 230);
                 if (r < 0)
                         return log_error_errno(r, "Failed to determine systemd version in container: %m");
-- 
2.18.0

